<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="againstCard.css" />
  </head>
  <body>
      <form>
        <input
        type="text"
        id="searchText"
        placeholder="Enter any number"
      /><input type="submit" id="searchBtn">
      </input>
    </form>    
    <div class="mainCard"></div>
    <div class="container">    
      <div class="weakCard" id="weaktitle"></div>
      <div class="strongCard" id="strongtitle"></div>
    </div>
    <script>
      document
        .getElementById('searchBtn')
        .addEventListener('click', (event) => {
          event.preventDefault();
          document.getElementById('weaktitle').innerHTML = 'Weak Against Pokemon'
          document.getElementById('strongtitle').innerHTML = 'Strong Against Pokemon'


          if (document.getElementById('searchText').value.length > 1) {
            fetch(
              `https://pokeapi.co/api/v2/pokemon/${document.getElementById('searchText').value}/`)
              .then((r) => r.json()) /*r = response*/
              .then((data1) => {
                let pokeInfo = document.createElement('div');
                let types_of_data = data1.types.map(eachobj=>eachobj.type.name).join(', ')
                pokeInfo.innerHTML = `
                <img src="${data1.sprites.front_default}">
                <p class="name">${data1.name}</p>
                  <li>Type:${types_of_data}</li>
                  <li id="js-weakagainst"></li>
                  <li id="js-strongagainst"></li>
                </div>`;
                pokeInfo.className = 'pokemoninfocard';


                fetch(`https://pokeapi.co/api/v2/type/${types_of_data}/`)
                  .then((r) => r.json())
                  .then((data)=>{
                    let weakAgainstArray = [];
                    let nodmgto = data.damage_relations.no_damage_to;
                    let halfdmgto = data.damage_relations.half_damage_to;
                    let doubledmgfrom = data.damage_relations.double_damage_from;
                    
                    let strongAgainstArray = [];
                    let nodmgfrom = data.damage_relations.no_damage_from;
                    let halfdmgfrom = data.damage_relations.half_damage_from;
                    let doubledmgto = data.damage_relations.double_damage_to;


                    nodmgto.map(type=>weakAgainstArray.push(type.name));
                    halfdmgto.map(type=>weakAgainstArray.push(type.name));
                    doubledmgfrom.map(type=>weakAgainstArray.push(type.name));


                    nodmgfrom.map(type=>strongAgainstArray.push(type.name));
                    halfdmgfrom.map(type=>strongAgainstArray.push(type.name));
                    doubledmgto.map(type=>strongAgainstArray.push(type.name));


                    let uniqueWeakTypes = [...new Set(weakAgainstArray)]
                    let uniqueStrongTypes = [...new Set(strongAgainstArray)]


                    function filtereven (eventypes){
                      return eventypes !== types_of_data
                    }


                    let filteredWeak = uniqueWeakTypes.filter(filtereven)
                    let filteredStrong = uniqueStrongTypes.filter(filtereven)


                    document.getElementById('js-weakagainst').innerHTML = `Weak Against: ${filteredWeak}`
                    document.getElementById('js-strongagainst').innerHTML = `Strong Against: ${filteredStrong}`
                    

                    for (let i = 1; i <= 151; i++) {
                      fetch(`https://pokeapi.co/api/v2/pokemon/${i}`)
                      .then((r) => r.json())
                      .then((info) => {
                        let alltypes = info.types.map(eachobj=>eachobj.type.name)

                        for(let i=0; i<filteredWeak.length; i++){
                          if(alltypes.includes(filteredWeak[i])){
                          let weakCardDiv = document.createElement('div')
                          weakCardDiv.innerHTML = `
                          <img src="${info.sprites.front_default}">
                          <p class="name">Name: ${info.name}</p>
                          <p class="id">ID: ${info.id}</p>
                          <p class="type">Type: ${info.types.map(eachobj=>eachobj.type.name)}</p>`
                          document.querySelector('.weakCard').append(weakCardDiv)
                          }

                          else if(alltypes.includes(filteredStrong[i])){
                          let strongCardDiv = document.createElement('div');
                          strongCardDiv.innerHTML = `
                          <img src="${info.sprites.front_default}">
                          <p class="name">Name: ${info.name}</p>
                          <p class="id">ID: ${info.id}</p>
                          <p class="type">Type: ${info.types.map(eachobj=>eachobj.type.name)}</p>`
                          document.querySelector('.strongCard').append(strongCardDiv)
                          }
                        }
                      })
                    }
                  })
                document.getElementById('searchText').value = '';
                document.querySelector('.mainCard').append(pokeInfo);
              });
          }
        });
    </script>
  </body>
</html>
